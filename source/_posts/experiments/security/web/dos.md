---
title: DoS拒绝服务攻击 
date: 2019-10-27 0:03:00 
tags:
  - "网络空间安全"
  - "网络安全"
categories:
  - ["实验","网络安全"]
  - ["漏洞","DoS"]

---

## 目标

掌握DoS攻击的基本原理和应用，分析一次工具发出的UDP Flood攻击。尝试使用WindowsXP编程实现SYN Flood攻击。
<!--more-->
{% note danger %} 本篇文章为实验记录，仅供交流学习使用，切勿违法应用，所有文中提到的工具不提供下载。 {% endnote %}

## 原理

* DoS攻击，又叫做拒绝服务攻击，是能导致合法用户不能正常访问网络服务的行为。其升级版本为DDoS（分布式拒绝服务攻击）。DoS攻击分为很多种，本次实验用到的是SYN Flood。
*
正常TCP请求需要经过三次握手过程，请求端（A）发送包含SYN标识的TCP报文，请求与服务端建立连接→服务端（B）返回一个SYN+ACK报文，表示接受客户端连接请求→客户端（A）返回确认报文ACK，双方确认连接建立。若请求端发送SYN包后，随即掉线，服务端会不停重试，再次尝试向A机发送SYN+ACK报文，等待一段时间后，丢弃连接，大量半开连接会消耗很多系统资源。
* SYN Flood攻击通过虚假的数据包，造成目标保存大量半开TCP连接，消耗很多系统资源，正常的请求不能得到响应，造成拒绝服务攻击。

## 步骤和关键技术

{% note info %} 所有实验的监测机均为运行着win10机器，ip地址为192.168.235.1，其运行着wireshark {% endnote %}

### 攻击工具进行的UDP flood攻击

本部分实验中，攻击机为运行winxp的机器，ip地址为192.168.235.136。 被攻击机为运行win2000的机器，ip地址为192.168.235.133。 首先确立目标，在被攻击机上运行`netstat -an`
，在打开的udp端口列表中，选择137端口为目标。

{% asset_img 1.png %} 在攻击机上打开udp flooder软件，指定ip和port，发送信息随便写一些内容，长度设为30秒，点击Go开始攻击，此过程中同时开启主机的wireshark软件开始抓包。 {%
asset_img 2.png %} {% asset_img 3.png %}

{% note info %} 速度并没有设的很快。 {% endnote %}

### 自己编程实现SYN flood攻击

{% note info %} 本次实验中，我选择了基于socket的实现。编程环境为winxp，测试环境为win2000。攻击机为运行win2000的机器，ip地址为192.168.235.141。
被攻击机为运行win2000的机器，ip地址为192.168.235.133，开启了21号端口（ftp服务）。源码见附件 {% endnote %}

## 数据和分析

### 分析攻击工具进行的UDP Flood攻击

{% asset_img 4.png %} {% asset_img 5.png %} 被攻击机把这个工具传输的数据包解析为NBNS协议。在攻击包中可以看到自己传输进去的信息，包的状态是被分割的且包是错误的形成的。可以看到，UDP
Flood主要是向目标机传送大量垃圾的错误协议包，从而打乱目标机的正常通信。

{% asset_img 6.png %} {% asset_img 7.png %}

### 分析自己编程实现的SYN Flood攻击

在目标机上开启FTP服务。确认21号tcp端口开启。 {% asset_img 8.png %} {% asset_img 9.png %}

在攻击机上运行攻击程序，发现目标机的cpu使用率飙升至满值，操作上也变得很卡。本来很顺畅的ping过程也受到了影响，开始存在掉包现象。关掉攻击后，系统cpu回复正常，网络回复正常。

{% asset_img 10.png %} {% asset_img 11.png %}

{% asset_img 12.png %} {% asset_img 13.png %} {% asset_img 14.png %}

观察ftp服务器的日志，可以看到有大量伪造ip源同本服务器建立了连接。 {% asset_img 15.png %}

下面分析wireshark抓包情况，可以看到，攻击机使用假地址`10.168.150.*` 向目标机发送了大量SYN请求，每次都使用不同的端口。[后来源码改成了`128.1.*.*`，本质不影响]
{% asset_img 16.png %} {% asset_img 17.png %}

{% asset_img 18.png %} {% asset_img 19.png %} 其中一个包体如截图所示，这个包体的SYN标志位被置为1。说明270号端口欲与服务器的21号端口建立连接。

观察整个发包过程，发现一开始服务器还可以响应一些连接。RST连接数目较少。后来（可能也触发了一些保护机制：发送窗口被设为0了），服务器开始重置连接，不停回应RST+ACK（而不是SYN flood的现象SYN+ACK）。 {%
asset_img 20.png %} {% asset_img 21.png %}

很不容易发回了一个SYN+ACK包，还被自己RST掉了。 {% asset_img 22.png %} {% asset_img 23.png %}

SYN+ACK包就是一个普通的三步握手中第二步的过程。

后来发现，编程时随机端口范围指定太大了，导致服务器忙于RST其他的端口而不发动重试。将端口范围调整至80~90后，出现了重试包。但这不是服务端的……本来就不存在的“伪造IP”端自己发动了一次重试？看来应该不是端口范围的问题…… {%
asset_img 24.png %} {% asset_img 25.png %}

我个人也没有想到是编程源码的问题还是服务端/客户端防火墙设置问题……

由于这个问题没能解决，也无法复现出服务端向客户端发送SYN+ACK包没有得到回应后，再次发动重试，从而建立了一个“半连接”的现象。因此，也无从再进一步分析。

## 收获

了解了一些常见的拒绝服务攻击原理，使用wireshark分析其中的两种拒绝服务攻击，进一步理解DoS攻击。
